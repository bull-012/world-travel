# ä¸–ç•Œæ—…è¡Œã‚¢ãƒ—ãƒª ã‚³ã‚¹ãƒˆï¼†åç›Šåˆ†æ

## ğŸ“Š åç›Šãƒ¢ãƒ‡ãƒ«

### ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

| ãƒ—ãƒ©ãƒ³ | æœˆé¡ | å¹´é¡ï¼ˆ20%å‰²å¼•ï¼‰ | æ©Ÿèƒ½ |
|--------|------|----------------|------|
| **Free** | Â¥0 | Â¥0 | â€¢ åŸºæœ¬æ©Ÿèƒ½<br>â€¢ æœˆ10ä»¶ã®ã‚¹ãƒãƒƒãƒˆä¿å­˜<br>â€¢ åºƒå‘Šè¡¨ç¤º |
| **Plus** | Â¥480 | Â¥4,608 | â€¢ åºƒå‘Šéè¡¨ç¤º<br>â€¢ ç„¡åˆ¶é™ã‚¹ãƒãƒƒãƒˆä¿å­˜<br>â€¢ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åœ°å›³<br>â€¢ å„ªå…ˆã‚µãƒãƒ¼ãƒˆ |
| **Premium** | Â¥980 | Â¥9,408 | â€¢ Pluså…¨æ©Ÿèƒ½<br>â€¢ AIæ—…è¡Œãƒ—ãƒ©ãƒ³ä½œæˆ<br>â€¢ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç¿»è¨³<br>â€¢ ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ |
| **Family** | Â¥1,480 | Â¥14,208 | â€¢ Premiumå…¨æ©Ÿèƒ½<br>â€¢ æœ€å¤§6ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ<br>â€¢ å®¶æ—é–“å…±æœ‰æ©Ÿèƒ½ |

### è¿½åŠ åç›Šæº

| åç›Šæº | å˜ä¾¡ | æƒ³å®šé »åº¦ | åç›Šæ€§ |
|--------|------|---------|--------|
| **ã‚¹ãƒãƒƒãƒˆäºˆç´„æ‰‹æ•°æ–™** | äºˆç´„é¡ã®8% | æœˆ2å›/ãƒ¦ãƒ¼ã‚¶ãƒ¼ | é«˜ |
| **åºƒå‘Šåå…¥** | Â¥0.5-2/è¡¨ç¤º | 100å›/æ—¥/ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ä¸­ |
| **ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ** | å£²ä¸Šã®3-5% | æœˆ1å›/ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ä¸­ |
| **ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„** | Â¥300-500 | æœˆ0.5å›/ãƒ¦ãƒ¼ã‚¶ãƒ¼ | ä½ |

---

## ğŸ’° åç›Šã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

### MAU 10,000äººã®å ´åˆ

#### èª²é‡‘ç‡æƒ³å®š
```
Free:     70% (7,000äºº)
Plus:     20% (2,000äºº)
Premium:  8% (800äºº)
Family:   2% (200äºº = ç´„33å®¶æ—)
```

#### æœˆé–“åç›Š
```
ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åå…¥:
Plus:     Â¥480 Ã— 2,000 = Â¥960,000
Premium:  Â¥980 Ã— 800 = Â¥784,000
Family:   Â¥1,480 Ã— 200 = Â¥296,000
å°è¨ˆ:     Â¥2,040,000

ãã®ä»–åå…¥:
äºˆç´„æ‰‹æ•°æ–™: Â¥500,000ï¼ˆå¹³å‡Â¥5,000Ã—8%Ã—1,250ä»¶ï¼‰
åºƒå‘Šåå…¥:   Â¥350,000ï¼ˆÂ¥0.5Ã—100å›Ã—7,000äººï¼‰
ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆ: Â¥150,000
å°è¨ˆ:     Â¥1,000,000

æœˆé–“ç·åå…¥: Â¥3,040,000
```

#### æœˆé–“ã‚³ã‚¹ãƒˆï¼ˆæœ€é©åŒ–å¾Œï¼‰
```
Firebase/GCP:     Â¥60,000
å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹:     Â¥30,000
æ±ºæ¸ˆæ‰‹æ•°æ–™(3.6%): Â¥73,440
ãã®ä»–:          Â¥10,000
æœˆé–“ç·ã‚³ã‚¹ãƒˆ:     Â¥173,440
```

#### æœˆé–“åˆ©ç›Š
```
åå…¥:     Â¥3,040,000
ã‚³ã‚¹ãƒˆ:   Â¥173,440
åˆ©ç›Š:     Â¥2,866,560
åˆ©ç›Šç‡:   94.3%
```

---

## ğŸ“ˆ æˆé•·äºˆæ¸¬

### ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ã¨åç›Šäºˆæ¸¬

| æ™‚æœŸ | MAU | èª²é‡‘ç‡ | æœˆé–“åå…¥ | æœˆé–“ã‚³ã‚¹ãƒˆ | æœˆé–“åˆ©ç›Š |
|------|-----|--------|----------|-----------|----------|
| 3ãƒ¶æœˆå¾Œ | 1,000 | 15% | Â¥200,000 | Â¥15,000 | Â¥185,000 |
| 6ãƒ¶æœˆå¾Œ | 5,000 | 25% | Â¥1,000,000 | Â¥50,000 | Â¥950,000 |
| 1å¹´å¾Œ | 10,000 | 30% | Â¥3,040,000 | Â¥173,440 | Â¥2,866,560 |
| 2å¹´å¾Œ | 50,000 | 32% | Â¥16,000,000 | Â¥500,000 | Â¥15,500,000 |
| 3å¹´å¾Œ | 100,000 | 35% | Â¥35,000,000 | Â¥800,000 | Â¥34,200,000 |

---

## ğŸ¯ èª²é‡‘æ©Ÿèƒ½å®Ÿè£…ã‚¬ã‚¤ãƒ‰ï¼ˆã‚¢ãƒ—ãƒªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ï¼‰

### 1. èª²é‡‘ã‚·ã‚¹ãƒ†ãƒ ã®é¸æŠ

#### RevenueCatï¼ˆæ¨å¥¨ï¼‰ 
```dart
// pubspec.yaml
dependencies:
  purchases_flutter: ^6.0.0

// åˆæœŸåŒ–ï¼ˆmain.dartï¼‰
import 'package:purchases_flutter/purchases_flutter.dart';

Future<void> initPurchases() async {
  await Purchases.setLogLevel(LogLevel.debug);
  
  PurchasesConfiguration configuration;
  if (Platform.isAndroid) {
    configuration = PurchasesConfiguration("goog_api_key");
  } else if (Platform.isIOS) {
    configuration = PurchasesConfiguration("appl_api_key");
  }
  
  await Purchases.configure(configuration);
}
```

#### å®Ÿè£…ãŒç°¡å˜ãªç†ç”±
- App Store/Google Playä¸¡å¯¾å¿œ
- ã‚µãƒ–ã‚¹ã‚¯ç®¡ç†ãŒè‡ªå‹•
- åˆ†ææ©Ÿèƒ½ä»˜ã
- Firebaseé€£æºå¯èƒ½

### 2. Firebaseã§ã®èª²é‡‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†

```dart
// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®èª²é‡‘æƒ…å ±ã‚’ä¿å­˜ã™ã‚‹æ§‹é€ 
class UserSubscription {
  final String plan; // 'free', 'plus', 'premium', 'family'
  final DateTime? expiresAt;
  final bool isActive;
  final String? familyGroupId;
  
  // Firestoreã«ä¿å­˜
  Map<String, dynamic> toFirestore() => {
    'plan': plan,
    'expiresAt': expiresAt,
    'isActive': isActive,
    'familyGroupId': familyGroupId,
  };
}
```

### 3. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆç°¡å˜ãªé †ï¼‰

#### Step 1: ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§ã‚¹ã‚¿ãƒ¼ãƒˆ
```dart
// ã¾ãšã¯å…¨æ©Ÿèƒ½ã‚’ç„¡æ–™ã§æä¾›
class FeatureAccess {
  static bool canSaveSpot() => true;
  static bool canViewOfflineMap() => true;
  static bool canUseAI() => true;
}
```

#### Step 2: æ©Ÿèƒ½åˆ¶é™ã‚’è¿½åŠ 
```dart
// èª²é‡‘ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§æ©Ÿèƒ½ã‚’åˆ¶é™
class FeatureAccess {
  static bool canSaveSpot(String plan) {
    if (plan == 'free') return savedCount < 10;
    return true;
  }
  
  static bool canViewOfflineMap(String plan) {
    return plan != 'free';
  }
  
  static bool canUseAI(String plan) {
    return plan == 'premium' || plan == 'family';
  }
}
```

#### Step 3: èª²é‡‘ç”»é¢ã®å®Ÿè£…
```dart
// ã‚·ãƒ³ãƒ—ãƒ«ãªèª²é‡‘ç”»é¢
class SubscriptionPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Column(
        children: [
          PlanCard(
            title: 'Plus',
            price: 'Â¥480/æœˆ',
            features: ['åºƒå‘Šéè¡¨ç¤º', 'ç„¡åˆ¶é™ä¿å­˜'],
            onTap: () => purchasePlan('plus'),
          ),
          PlanCard(
            title: 'Premium',
            price: 'Â¥980/æœˆ',
            features: ['AIæ©Ÿèƒ½', 'ç¿»è¨³æ©Ÿèƒ½'],
            onTap: () => purchasePlan('premium'),
          ),
        ],
      ),
    );
  }
}
```

---

## ğŸ’¡ ã‚³ã‚¹ãƒˆæœ€é©åŒ–ã®ãƒã‚¤ãƒ³ãƒˆï¼ˆç°¡å˜ã«å®Ÿè£…ã§ãã‚‹é †ï¼‰

### 1. ä»Šã™ãã§ãã‚‹å¯¾ç­–ï¼ˆ1æ—¥ã§å®Ÿè£…ï¼‰

#### ç”»åƒã‚’å°ã•ãã™ã‚‹
```dart
// Before: å¤§ãã„ç”»åƒã‚’ãã®ã¾ã¾ä½¿ç”¨
Image.network(photoUrl);

// After: ã‚µã‚¤ã‚ºæŒ‡å®šã—ã¦èª­ã¿è¾¼ã¿
CachedNetworkImage(
  imageUrl: photoUrl,
  memCacheWidth: 400,  // ãƒ¡ãƒ¢ãƒªä¸Šã§ãƒªã‚µã‚¤ã‚º
  memCacheHeight: 400,
);
```

#### ãƒ‡ãƒ¼ã‚¿ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹
```dart
// SharedPreferencesã§ç°¡å˜ã‚­ãƒ£ãƒƒã‚·ãƒ¥
Future<List<Spot>> getSpots() async {
  final prefs = await SharedPreferences.getInstance();
  final cached = prefs.getString('spots_cache');
  
  if (cached != null) {
    final data = json.decode(cached);
    final cacheTime = DateTime.parse(data['time']);
    
    // 1æ™‚é–“ä»¥å†…ãªã‚‰ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨
    if (DateTime.now().difference(cacheTime).inHours < 1) {
      return data['spots'];
    }
  }
  
  // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒãªã‘ã‚Œã°Firestoreã‹ã‚‰å–å¾—
  final spots = await fetchFromFirestore();
  prefs.setString('spots_cache', json.encode({
    'time': DateTime.now().toIso8601String(),
    'spots': spots,
  }));
  
  return spots;
}
```

### 2. 1é€±é–“ã§å®Ÿè£…ã§ãã‚‹å¯¾ç­–

#### CDN ã‚’ä½¿ã†ï¼ˆCloudflareç„¡æ–™ï¼‰
1. Cloudflareã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
2. ãƒ‰ãƒ¡ã‚¤ãƒ³è¿½åŠ 
3. DNSã‚’Cloudflareã«å¤‰æ›´
â†’ ç”»åƒé…ä¿¡ãŒ70%é«˜é€ŸåŒ–

#### ãƒãƒƒãƒå‡¦ç†ã§ãƒ‡ãƒ¼ã‚¿å–å¾—
```dart
// Before: å€‹åˆ¥ã«10å›å–å¾—
for (final id in spotIds) {
  final spot = await firestore.collection('spots').doc(id).get();
}

// After: 1å›ã§ã¾ã¨ã‚ã¦å–å¾—
final spots = await firestore
  .collection('spots')
  .where(FieldPath.documentId, whereIn: spotIds)
  .get();
```

---

## ğŸ“Š æœ€çµ‚çš„ãªã‚³ã‚¹ãƒˆæ§‹é€ 

### MAUåˆ¥ã®åæ”¯äºˆæ¸¬

| MAU | åå…¥/æœˆ | ã‚³ã‚¹ãƒˆ/æœˆ | åˆ©ç›Š/æœˆ | åˆ©ç›Šç‡ |
|-----|---------|----------|---------|--------|
| 1,000 | Â¥200,000 | Â¥15,000 | Â¥185,000 | 92.5% |
| 5,000 | Â¥1,000,000 | Â¥50,000 | Â¥950,000 | 95.0% |
| 10,000 | Â¥3,040,000 | Â¥173,440 | Â¥2,866,560 | 94.3% |
| 50,000 | Â¥16,000,000 | Â¥500,000 | Â¥15,500,000 | 96.9% |
| 100,000 | Â¥35,000,000 | Â¥800,000 | Â¥34,200,000 | 97.7% |

### ãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¤ãƒ¼ãƒ–ãƒ³ãƒã‚¤ãƒ³ãƒˆ
- **ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿**: èµ¤å­—
- **èª²é‡‘ç‡5%**: MAU 500äººã§é»’å­—åŒ–
- **èª²é‡‘ç‡15%**: MAU 200äººã§é»’å­—åŒ–
- **èª²é‡‘ç‡30%**: MAU 100äººã§é»’å­—åŒ–

---

## âœ… ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### Phase 1: MVPï¼ˆç„¡æ–™ç‰ˆãƒªãƒªãƒ¼ã‚¹ï¼‰
1. å…¨æ©Ÿèƒ½ã‚’ç„¡æ–™ã§æä¾›
2. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç²å¾—ã«é›†ä¸­
3. Firebaseç„¡æ–™æ ã§é‹ç”¨
4. **ç›®æ¨™**: 1,000 MAUç²å¾—

### Phase 2: èª²é‡‘é–‹å§‹ï¼ˆ3ãƒ¶æœˆå¾Œï¼‰
1. RevenueCatå°å…¥
2. Plus/Premiumãƒ—ãƒ©ãƒ³è¿½åŠ 
3. åºƒå‘Šå®Ÿè£…ï¼ˆç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼‰
4. **ç›®æ¨™**: èª²é‡‘ç‡15%é”æˆ

### Phase 3: åç›Šæœ€å¤§åŒ–ï¼ˆ6ãƒ¶æœˆå¾Œï¼‰
1. äºˆç´„æ©Ÿèƒ½è¿½åŠ ï¼ˆæ‰‹æ•°æ–™åå…¥ï¼‰
2. ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆé–‹å§‹
3. Familyãƒ—ãƒ©ãƒ³è¿½åŠ 
4. **ç›®æ¨™**: æœˆå•†100ä¸‡å††é”æˆ

### Phase 4: ã‚¹ã‚±ãƒ¼ãƒ«ï¼ˆ1å¹´å¾Œï¼‰
1. æ³•äººå‘ã‘ãƒ—ãƒ©ãƒ³
2. APIæä¾›
3. ãƒ›ãƒ¯ã‚¤ãƒˆãƒ©ãƒ™ãƒ«
4. **ç›®æ¨™**: æœˆå•†300ä¸‡å††é”æˆ

---

## ğŸš€ æˆåŠŸã®éµ

### èª²é‡‘ç‡ã‚’ä¸Šã’ã‚‹ã‚³ãƒ„
1. **ç„¡æ–™ã§ä¾¡å€¤ã‚’ä½“é¨“ã•ã›ã‚‹** â†’ æœŸé–“é™å®šã§å…¨æ©Ÿèƒ½é–‹æ”¾
2. **ç—›ã¿ã‚’è§£æ±ºã™ã‚‹** â†’ åºƒå‘Šéè¡¨ç¤ºã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ
3. **é™å®šæ„Ÿã‚’æ¼”å‡º** â†’ æ—©æœŸå‰²å¼•ã€é™å®šæ©Ÿèƒ½
4. **å®¶æ—ãƒ—ãƒ©ãƒ³ã§å˜ä¾¡UP** â†’ 1äººã‚ãŸã‚Šã¯å®‰ãã€ç·é¡ã¯é«˜ã

### ã‚³ã‚¹ãƒˆã‚’æŠ‘ãˆã‚‹ã‚³ãƒ„
1. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ€å„ªå…ˆ** â†’ Firestoreã®èª­ã¿å–ã‚Šã‚’æœ€å°åŒ–
2. **ç”»åƒã¯å¿…é ˆæœ€é©åŒ–** â†’ WebPã€ãƒªã‚µã‚¤ã‚ºã€é…å»¶èª­ã¿è¾¼ã¿
3. **ç„¡æ–™ã‚µãƒ¼ãƒ“ã‚¹æ´»ç”¨** â†’ Cloudflareã€GitHub Actions
4. **æ®µéšçš„ã«æŠ•è³‡** â†’ åç›Šã«å¿œã˜ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰

ã“ã‚Œã§å¹´å•†4,000ä¸‡å††ï¼ˆåˆ©ç›Šç‡95%ï¼‰ã‚’ç›®æŒ‡ã›ã‚‹è¨­è¨ˆã§ã™ã€‚